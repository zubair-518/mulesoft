<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:metadata="http://www.mulesoft.org/schema/mule/metadata" xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd">
    <http:listener-config name="HTTP_Listener_Configuration" host="0.0.0.0" port="8081" doc:name="HTTP Listener Configuration"/>
    <flow name="tstFlow">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/t" doc:name="HTTP"/>
        <object-to-string-transformer doc:name="Object to String"/>
        <set-variable variableName="actualPayload" value="#[payload]"  doc:name="actualPayload"/>
        <set-variable variableName="token" value="&lt;saml:Assertion xmlns:saml=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot; ID=&quot;t8QHz4moHa-q4cIwylzbu_2UKkv&quot; IssueInstant=&quot;2020-05-28T18:42:27.701Z&quot; Version=&quot;2.0&quot;&gt;&lt;saml:Issuer&gt;https://www.bankofamerica.com/sts-int-sit&lt;/saml:Issuer&gt;&lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;&lt;ds:SignedInfo&gt;&lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;/&gt;&lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;/&gt;&lt;ds:Reference URI=&quot;#t8QHz4moHa-q4cIwylzbu_2UKkv&quot;&gt;&lt;ds:Transforms&gt;&lt;ds:Transform Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;/&gt;&lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;/&gt;&lt;/ds:Transforms&gt;&lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;/&gt;&lt;ds:DigestValue&gt;S2M4DlIfy2WaMK6zJT5L2D5gZYg=&lt;/ds:DigestValue&gt;&lt;/ds:Reference&gt;&lt;/ds:SignedInfo&gt;&lt;ds:SignatureValue&gt;ipjvFOg7q+qZhfI0BQh/Hg4ActBnOWxp8sJ0DT2kpOlmU2+xmCoOWpckMNeaI+P3XsjSDsPnF1Kwo7cR7Ku970sItE/oRM96ewAFZQA9rCo8VcaURwBOwSMvGwIyMfJv3HTx7A12U8tAi0mlaSpxmz+9g6hJ1/hFkOfPNrr3EXQs2yP56t2uHh9uAtjSCvRa9OM2Hh5jHNg6cKgWR179EW4xcQ5zTFZ5Tqd3rKFwtNAi3EHqfxXgBsrHVaWIHRIcbIQ60Q1xW92ncqA9MmB2PaWx6Ulz/ZdW8Fo+DE9KMt3qClOnh494t6dwXtj/ibXKSXRB2JJ/6B8zMPYohdisig==&lt;/ds:SignatureValue&gt;&lt;ds:KeyInfo&gt;&lt;ds:X509Data&gt;&lt;ds:X509Certificate&gt;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&lt;/ds:X509Certificate&gt;&lt;/ds:X509Data&gt;&lt;ds:KeyValue&gt;&lt;ds:RSAKeyValue&gt;&lt;ds:Modulus&gt;tlDywr0L0R32g7rfd4NT1KS0bRIbF+I/Z5U2SFNXNaaDq/wDPJOv52vPNytPayZbXPKMmhGqqww7RDeQlYRPFTSuF9TQuGkg2oDamErfgul/05Pb05M4O5H3H7AtYsJYpslObh6hTBd99lN6k2kGq5j3+VmDyBoOXw2AjIosFZuO6mprphUh2rkQkxfvuLmFXOWw8OHvn4gil4VvXlt9GB4fsdbvAZxTDeBTulmNyCaY9IjKpFaO3uR8kvqTFhXnpuOk9J3ibuQvDzuLMCdbYc95B61d3PFoFY/tVqV4KRDvS/a7lLVcJqIgkQYi9B6xIyCrZkVObxUh1kQNMfWtvQ==&lt;/ds:Modulus&gt;&lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;&lt;/ds:RSAKeyValue&gt;&lt;/ds:KeyValue&gt;&lt;/ds:KeyInfo&gt;&lt;/ds:Signature&gt;&lt;saml:Subject&gt;&lt;saml:NameID Format=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot;&gt;SFHL&lt;/saml:NameID&gt;&lt;saml:SubjectConfirmation Method=&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;/&gt;&lt;/saml:Subject&gt;&lt;saml:Conditions NotBefore=&quot;2020-05-28T18:37:27.701Z&quot; NotOnOrAfter=&quot;2020-05-29T04:42:27.701Z&quot;&gt;&lt;saml:AudienceRestriction&gt;&lt;saml:Audience&gt;https://sts-int.bankofamerica.com/EIB&lt;/saml:Audience&gt;&lt;/saml:AudienceRestriction&gt;&lt;/saml:Conditions&gt;&lt;saml:AuthnStatement AuthnInstant=&quot;2020-05-28T18:42:27.701Z&quot; SessionIndex=&quot;t8QHz4moHa-q4cIwylzbu_2UKkv&quot;&gt;&lt;saml:AuthnContext&gt;&lt;saml:AuthnContextClassRef&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified&lt;/saml:AuthnContextClassRef&gt;&lt;/saml:AuthnContext&gt;&lt;/saml:AuthnStatement&gt;&lt;saml:AttributeStatement&gt;&lt;saml:Attribute Name=&quot;AIT&quot; NameFormat=&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;&gt;&lt;saml:AttributeValue xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:type=&quot;xs:string&quot;&gt;53421&lt;/saml:AttributeValue&gt;&lt;/saml:Attribute&gt;&lt;/saml:AttributeStatement&gt;&lt;/saml:Assertion&gt;"  doc:name="token" mimeType="application/xml"/>
        <set-variable variableName="sToken" value="#['&lt;Security&gt;\n\t' + flowVars.token + '\n&lt;/Security&gt;']" mimeType="application/xml" doc:name="sToken"/>
        <set-variable variableName="securityToken" value="#['&lt;Security&gt;\n\t' + flowVars.token + '\n&lt;/Security&gt;']" doc:name="securityToken"/>
        <set-variable variableName="EIB_Credential" value="PHNhbWw6QXNzZXJ0aW9uIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJ0OFFIejRtb0hhLXE0Y0l3eWx6YnVfMlVLa3YiIElzc3VlSW5zdGFudD0iMjAyMC0wNS0yOFQxODo0MjoyNy43MDFaIiBWZXJzaW9uPSIyLjAiPjxzYW1sOklzc3Vlcj5odHRwczovL3d3dy5iYW5rb2ZhbWVyaWNhLmNvbS9zdHMtaW50LXNpdDwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiN0OFFIejRtb0hhLXE0Y0l3eWx6YnVfMlVLa3YiPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PGRzOkRpZ2VzdFZhbHVlPlMyTTREbElmeTJXYU1LNnpKVDVMMkQ1Z1pZZz08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+aXBqdkZPZzdxK3FaaGZJMEJRaC9IZzRBY3RCbk9XeHA4c0owRFQya3BPbG1VMit4bUNvT1dwY2tNTmVhSStQM1hzalNEc1BuRjFLd283Y1I3S3U5NzBzSXRFL29STTk2ZXdBRlpRQTlyQ284VmNhVVJ3Qk93U012R3dJeU1mSnYzSFR4N0ExMlU4dEFpMG1sYVNweG16KzlnNmhKMS9oRmtPZlBOcnIzRVhRczJ5UDU2dDJ1SGg5dUF0alNDdlJhOU9NMkhoNWpITmc2Y0tnV1IxNzlFVzR4Y1E1elRGWjVUcWQzcktGd3ROQWkzRUhxZnhYZ0JzckhWYVdJSFJJY2JJUTYwUTF4VzkybmNxQTlNbUIyUGFXeDZVbHovWmRXOEZvK0RFOUtNdDNxQ2xPbmg0OTR0NmR3WHRqL2liWEtTWFJCMkpKLzZCOHpNUFlvaGRpc2lnPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUhaRENDQmt5Z0F3SUJBZ0lLVWoxQ0hnQUFBQUU0WVRBTkJna3Foa2lHOXcwQkFRc0ZBREJZTVFzd0NRWURWUVFHRXdKVlV6RVlNQllHQTFVRUNoTVBRbUZ1YXlCdlppQkJiV1Z5YVdOaE1TOHdMUVlEVlFRREV5WkpibVp5WVhOMGNuVmpkSFZ5WlNCQmRYUm9iM0pwZEhrZ1VISnBiV0Z5ZVNBdElFY3pRVEFlRncweE9UQTBNRGt4TkRJME1EUmFGdzB5TVRBME1EZ3hOREkwTURSYU1JR2lNUXN3Q1FZRFZRUUdFd0pWVXpFWE1CVUdBMVVFQ0JNT1RtOXlkR2dnUTJGeWIyeHBibUV4RWpBUUJnTlZCQWNUQ1VOb1lYSnNiM1IwWlRFa01DSUdBMVVFQ2hNYlFtRnVheUJ2WmlCQmJXVnlhV05oSUVOdmNuQnZjbUYwYVc5dU1TZ3dKZ1lEVlFRTEV4OUJZMk5sYzNNZ1lXNWtJRWxrWlc1MGFYUjVJRVZ1WjJsdVpXVnlhVzVuTVJZd0ZBWURWUVFERXcwek5qQTBNeTF1YjI1d2NtOWtNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXRsRHl3cjBMMFIzMmc3cmZkNE5UMUtTMGJSSWJGK0kvWjVVMlNGTlhOYWFEcS93RFBKT3Y1MnZQTnl0UGF5WmJYUEtNbWhHcXF3dzdSRGVRbFlSUEZUU3VGOVRRdUdrZzJvRGFtRXJmZ3VsLzA1UGIwNU00TzVIM0g3QXRZc0pZcHNsT2JoNmhUQmQ5OWxONmsya0dxNWozK1ZtRHlCb09YdzJBaklvc0ZadU82bXBycGhVaDJya1FreGZ2dUxtRlhPV3c4T0h2bjRnaWw0VnZYbHQ5R0I0ZnNkYnZBWnhURGVCVHVsbU55Q2FZOUlqS3BGYU8zdVI4a3ZxVEZoWG5wdU9rOUozaWJ1UXZEenVMTUNkYlljOTVCNjFkM1BGb0ZZL3RWcVY0S1JEdlMvYTdsTFZjSnFJZ2tRWWk5QjZ4SXlDclprVk9ieFVoMWtRTk1mV3R2UUlEQVFBQm80SUQ0ekNDQTk4d0dBWURWUjBSQkJFd0Q0SU5Nell3TkRNdGJtOXVjSEp2WkRBZEJnTlZIUTRFRmdRVWxPcWRiYlRLL0ZPVk1CVnYvVkJJN2tleXdQQXdId1lEVlIwakJCZ3dGb0FVS0M1aitROStRcDhxcDJtb2NDTG5nUTlrbGtRd2dnRmhCZ05WSFI4RWdnRllNSUlCVkRDQ0FWQ2dnZ0ZNb0lJQlNJWmthSFIwY0RvdkwyTmxjblJwWm1sallYUmxjeTVpWVc1cmIyWmhiV1Z5YVdOaExtTnZiUzlwUTBFdlkzSnNaR0YwWVM5SmJtWnlZWE4wY25WamRIVnlaU1V5TUVGMWRHaHZjbWwwZVNVeU1GQnlhVzFoY25rbE1qQXRKVEl3UnpOQkxtTnliSWFCMzJ4a1lYQTZMeTh2UTA0OVNXNW1jbUZ6ZEhKMVkzUjFjbVVsTWpCQmRYUm9iM0pwZEhrbE1qQlFjbWx0WVhKNUpUSXdMU1V5TUVjelFTeERUajFEVWxCRFZGaE5RMEV3TVN4RFRqMURSRkFzUTA0OVVIVmliR2xqSlRJd1MyVjVKVEl3VTJWeWRtbGpaWE1zUTA0OVUyVnlkbWxqWlhNc1EwNDlRMjl1Wm1sbmRYSmhkR2x2Yml4RVF6MWlZVzVyYjJaaGJXVnlhV05oTEVSRFBXTnZiVDlqWlhKMGFXWnBZMkYwWlZKbGRtOWpZWFJwYjI1TWFYTjBQMkpoYzJVL2IySnFaV04wUTJ4aGMzTTlZMUpNUkdsemRISnBZblYwYVc5dVVHOXBiblF3Z2dHTEJnZ3JCZ0VGQlFjQkFRU0NBWDB3Z2dGNU1IRUdDQ3NHQVFVRkJ6QUNobVZvZEhSd09pOHZZMlZ5ZEdsbWFXTmhkR1Z6TG1KaGJtdHZabUZ0WlhKcFkyRXVZMjl0TDJsRFFTOWpaWEowWkdGMFlTOUpibVp5WVhOMGNuVmpkSFZ5WlNVeU1FRjFkR2h2Y21sMGVTVXlNRkJ5YVcxaGNua2xNakF0SlRJd1J6TkJMbU55ZERDQjB3WUlLd1lCQlFVSE1BS0dnY1pzWkdGd09pOHZMME5PUFVsdVpuSmhjM1J5ZFdOMGRYSmxKVEl3UVhWMGFHOXlhWFI1SlRJd1VISnBiV0Z5ZVNVeU1DMGxNakJITTBFc1EwNDlRVWxCTEVOT1BWQjFZbXhwWXlVeU1FdGxlU1V5TUZObGNuWnBZMlZ6TEVOT1BWTmxjblpwWTJWekxFTk9QVU52Ym1acFozVnlZWFJwYjI0c1JFTTlZbUZ1YTI5bVlXMWxjbWxqWVN4RVF6MWpiMjAvWTBGRFpYSjBhV1pwWTJGMFpUOWlZWE5sUDI5aWFtVmpkRU5zWVhOelBXTmxjblJwWm1sallYUnBiMjVCZFhSb2IzSnBkSGt3TGdZSUt3WUJCUVVITUFHR0ltaDBkSEE2THk5dlkzTndMbUpoYm10dlptRnRaWEpwWTJFdVkyOXRMMjlqYzNBd0N3WURWUjBQQkFRREFnV2dNRG9HQ1NzR0FRUUJnamNWQndRdE1Dc0dJeXNHQVFRQmdqY1ZDSVhJMWdPWnJSZUhxWWNZZ2EzWGE0YkpyVmtpMGRGdC9xOHpBZ0ZrQWdFRU1CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFuQmdrckJnRUVBWUkzRlFvRUdqQVlNQW9HQ0NzR0FRVUZCd01CTUFvR0NDc0dBUVVGQndNQ01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQU9ZSElUMmJYemhTbzNlcjRqdFNCMUt5OWQ3TVNmS2lQQ1hwbHB6ajlIM0o1VC9RS2dhL2tZV3NIRmZHMG1PUlJ3YVZkbzA4UzBCME1yOG5yakZ4bm9PODF6Ylh5S3kyS0tFMXkvcCtzajliVUZaRVJ2V0loaE5uZmRCWU5YQ1JQdytpZDZ3Ly91UE4rRWVsQjhDSkFOampCU21LKzgvZGJpcXNyejB2ZlR3VEhxd0xFd0RQbkMxK3lUaVlXY0tLMjRaQUVCajlIOERxNXRtcVQ0L1dnU3JKazEwUUpsRllLNkRJQkJSTFJMaTNSa0c2T3JHckpFUjl1a09Eb3Jtalo5cW5mWTJHMHQxRXpHRnh5ZHZ0QkRvRnpzdUZSVksrT0tObzNuekUzeXJIVm95Zk4xNmM1VGMxSU9jck1wT090NzlvRC9YRzZYS2UxblN3SGxPSkRVPC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48ZHM6S2V5VmFsdWU+PGRzOlJTQUtleVZhbHVlPjxkczpNb2R1bHVzPnRsRHl3cjBMMFIzMmc3cmZkNE5UMUtTMGJSSWJGK0kvWjVVMlNGTlhOYWFEcS93RFBKT3Y1MnZQTnl0UGF5WmJYUEtNbWhHcXF3dzdSRGVRbFlSUEZUU3VGOVRRdUdrZzJvRGFtRXJmZ3VsLzA1UGIwNU00TzVIM0g3QXRZc0pZcHNsT2JoNmhUQmQ5OWxONmsya0dxNWozK1ZtRHlCb09YdzJBaklvc0ZadU82bXBycGhVaDJya1FreGZ2dUxtRlhPV3c4T0h2bjRnaWw0VnZYbHQ5R0I0ZnNkYnZBWnhURGVCVHVsbU55Q2FZOUlqS3BGYU8zdVI4a3ZxVEZoWG5wdU9rOUozaWJ1UXZEenVMTUNkYlljOTVCNjFkM1BGb0ZZL3RWcVY0S1JEdlMvYTdsTFZjSnFJZ2tRWWk5QjZ4SXlDclprVk9ieFVoMWtRTk1mV3R2UT09PC9kczpNb2R1bHVzPjxkczpFeHBvbmVudD5BUUFCPC9kczpFeHBvbmVudD48L2RzOlJTQUtleVZhbHVlPjwvZHM6S2V5VmFsdWU+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6MS4xOm5hbWVpZC1mb3JtYXQ6dW5zcGVjaWZpZWQiPlNGSEw8L3NhbWw6TmFtZUlEPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIi8+PC9zYW1sOlN1YmplY3Q+PHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMjAtMDUtMjhUMTg6Mzc6MjcuNzAxWiIgTm90T25PckFmdGVyPSIyMDIwLTA1LTI5VDA0OjQyOjI3LjcwMVoiPjxzYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+PHNhbWw6QXVkaWVuY2U+aHR0cHM6Ly9zdHMtaW50LmJhbmtvZmFtZXJpY2EuY29tL0VJQjwvc2FtbDpBdWRpZW5jZT48L3NhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWw6Q29uZGl0aW9ucz48c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjAtMDUtMjhUMTg6NDI6MjcuNzAxWiIgU2Vzc2lvbkluZGV4PSJ0OFFIejRtb0hhLXE0Y0l3eWx6YnVfMlVLa3YiPjxzYW1sOkF1dGhuQ29udGV4dD48c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3Nlczp1bnNwZWNpZmllZDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWw6QXV0aG5Db250ZXh0Pjwvc2FtbDpBdXRoblN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWw6QXR0cmlidXRlIE5hbWU9IkFJVCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj41MzQyMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sOkFzc2VydGlvbj4=" doc:name="EIB_Credential"/>
        <choice doc:name="Choice">
            <when expression="#[(xpath3('//*:Header',payload,&quot;NODE&quot;) != null) &amp;&amp; (xpath3('//*:Security',payload,&quot;NODE&quot;) != null)]">
                <dw:transform-message doc:name="Transform Message" metadata:id="232bfd86-6089-4a3f-9502-b62ff72bc49c">
                    <dw:input-payload doc:sample="sample_data\empty_5.xml"/>
                    <dw:input-variable doc:sample="sample_data\empty_6.xml" variableName="Security"/>
                    <dw:input-variable variableName="EIB_Credential"/>
                    <dw:input-variable variableName="IsHeader"/>
                    <dw:input-variable variableName="token"/>
                    <dw:set-payload><![CDATA[%dw 1.0
%output  application/java
---

(flowVars.actualPayload replace /(?s)<Security[^>]*>.*?<\\/Security>/ with flowVars.securityToken) 
]]></dw:set-payload>
                </dw:transform-message>
            </when>
            <when expression="#[(xpath3('//*:Header',payload,&quot;NODE&quot;) != null) &amp;&amp; ((xpath3('//*:Security',payload,&quot;NODE&quot;) != null) == false)]">
                <dw:transform-message doc:name="Transform Message">
                    <dw:set-payload><![CDATA[%dw 1.0
%output  application/xml
---

(
Envelope:{
Header: flowVars.sToken ++ payload.Envelope.Header ,
Body: payload.Envelope.Body
})


]]></dw:set-payload>
                </dw:transform-message>
            </when>
            <otherwise>
                <dw:transform-message doc:name="Transform Message">
                    <dw:set-variable variableName="senario2"><![CDATA[%dw 1.0
%output  application/java
---
flowVars.actualPayload


]]></dw:set-variable>
                </dw:transform-message>
            </otherwise>
        </choice>

        <logger level="INFO" doc:name="Logger" message="#[payload]"/>
    </flow>
</mule>
